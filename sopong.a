
	processor 6502
        include "vcs.h"
        include "macro.h"
        include "xmacro.h"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Variables segment

        seg.u Variables
	org $80

dotcount .byte

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Code segment

	seg Code
        org $f000

Start
	CLEAN_START
	lda #$0a
	sta COLUPF
        lda #1
        sta CTRLPF
	

NextFrame
        lsr SWCHB	; test Game Reset switch
        bcc Start	; reset?
; 1 + 3 lines of VSYNC
	VERTICAL_SYNC
; 37 lines of underscan
	TIMER_SETUP 37
        TIMER_WAIT
        ldx #0
        stx VBLANK
        lda #$ff
        sta PF0
        sta PF1
	sta PF2       		
        lda #%10000000
        ldy #7
tline        
        sta WSYNC
        dey
        bne tline
        ldy #11
        sty dotcount
tdots

        ldy #8
tdot1
	sta WSYNC
	stx PF0
	stx PF1
	sta PF2
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
	stx PF2
	dey 
        bne tdot1

        ldy #8

tdot2
	sta WSYNC
	stx PF0
	stx PF1
	stx PF2
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
        nop 
        nop
        nop 
        nop 
	sta PF2
	dey 
        bne tdot2

	dec dotcount
        ldy dotcount
       	bne tdots 
            
 	sta WSYNC            
            
        lda #$ff
        sta PF0
        sta PF1
	sta PF2       		
        lda #%10000000
        ldy #7
bline        
        sta WSYNC
        dey
        bne bline

; 29 lines of overscan
        lda #2
        sta VBLANK
	TIMER_SETUP 29
        TIMER_WAIT
; total = 262 lines, go to next frame
        jmp NextFrame

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Epilogue

	org $fffc
        .word Start	; reset vector
        .word Start	; BRK vector
